{"version":3,"file":"persist.cjs","names":["_errors","require","_isDeepEqual","_interopRequireDefault","e","__esModule","asyncGeneratorStep","n","t","r","o","a","c","i","u","value","done","Promise","resolve","then","_asyncToGenerator","arguments","apply","_next","_throw","saveAll","exports","state","oldState","_ref","prefix","driver","serialize","isDeepEqual","setItem","saveAllKeyed","_ref2","all","Object","keys","map","key","persist","_ref4","_ref3","persistWholeStore","errorHandler","save","err","PersistError","_x","_x2","_x3"],"sources":["../../src/persist.ts"],"sourcesContent":["import { PersistError } from './errors';\nimport isDeepEqual from './is-deep-equal';\nimport { ExtendedOptions } from './types';\n\ntype PersistOptions = Pick<\n  ExtendedOptions,\n  'prefix' | 'driver' | 'serialize' | 'persistWholeStore' | 'errorHandler'\n>\n\ntype SaveAllOptions = Pick<\n  ExtendedOptions,\n  'prefix' | 'driver' | 'serialize'\n>;\n\nexport const saveAll = (\n  state: any,\n  oldState: any,\n  { prefix, driver, serialize }: SaveAllOptions\n) => {\n  if (!isDeepEqual(state, oldState)) {\n    return driver.setItem(\n      `${prefix}rootState`,\n      serialize(state, 'rootState')\n    );\n  }\n};\n\nexport const saveAllKeyed = (\n  state: any,\n  oldState: any,\n  { prefix, driver, serialize }: SaveAllOptions\n) => Promise.all(\n  Object.keys(state).map((key) => {\n    if (isDeepEqual(state[key], oldState[key])) {\n      return Promise.resolve();\n    }\n\n    return driver.setItem(\n      `${prefix}${key}`,\n      serialize(state[key], key)\n    );\n  })\n);\n\nexport const persist = async (\n  state = {},\n  oldState = {},\n  {\n    prefix,\n    driver,\n    persistWholeStore,\n    serialize,\n    errorHandler\n  }: PersistOptions\n) => {\n  try {\n    const save = persistWholeStore\n      ? saveAll\n      : saveAllKeyed;\n\n    await save(\n      state,\n      oldState,\n      { prefix, driver, serialize }\n    );\n  } catch (err) {\n    errorHandler(new PersistError(err));\n  }\n};\n"],"mappings":"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","ignoreList":[]}