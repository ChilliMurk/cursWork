{"version":3,"file":"rehydrate.cjs","names":["_actionTypes","require","_utils","_errors","ownKeys","e","r","t","Object","keys","getOwnPropertySymbols","o","filter","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","arguments","length","forEach","_defineProperty","getOwnPropertyDescriptors","defineProperties","defineProperty","_toPropertyKey","value","configurable","writable","i","_toPrimitive","Symbol","toPrimitive","call","TypeError","String","Number","asyncGeneratorStep","n","a","c","u","done","Promise","resolve","then","_asyncToGenerator","_next","_throw","loadAll","exports","_ref2","_ref","rememberedKeys","driver","prefix","unserialize","key","data","getItem","undefined","pick","_x","loadAllKeyed","_ref4","_ref3","items","all","map","reduce","obj","_x2","rehydrate","_ref6","store","_ref5","persistWholeStore","errorHandler","state","getState","load","err","RehydrateError","dispatch","type","REMEMBER_REHYDRATED","payload","_x3","_x4","_x5"],"sources":["../../src/rehydrate.ts"],"sourcesContent":["import { Store } from 'redux';\nimport { REMEMBER_REHYDRATED } from './action-types';\nimport { ExtendedOptions } from './types';\nimport { pick } from './utils';\nimport { RehydrateError } from './errors';\n\ntype RehydrateOptions = Pick<\n  ExtendedOptions,\n  'driver' | 'prefix' | 'unserialize' | 'persistWholeStore' | 'errorHandler'\n>\n\ntype LoadAllOptions = Pick<\n  ExtendedOptions,\n  'driver' | 'prefix' | 'unserialize'\n> & {\n  rememberedKeys: string[]\n};\n\nexport const loadAll = async ({\n  rememberedKeys,\n  driver,\n  prefix,\n  unserialize\n}: LoadAllOptions): Promise<Record<string, any>> => {\n  const key = 'rootState';\n  const data = await driver.getItem(`${prefix}${key}`);\n\n  if (data === null || data === undefined) {\n    return {};\n  }\n\n  return pick(\n    unserialize(data, key),\n    rememberedKeys\n  );\n};\n\nexport const loadAllKeyed = async ({\n  rememberedKeys,\n  driver,\n  prefix,\n  unserialize\n}: LoadAllOptions): Promise<Record<string, any>> => {\n  const items = await Promise.all(\n    rememberedKeys.map((key) => driver.getItem(\n      `${prefix}${key}`\n    ))\n  );\n\n  return rememberedKeys.reduce((obj: Record<string, any>, key, i) => {\n    if (items[i] !== null && items[i] !== undefined) {\n      obj[key] = unserialize(items[i], key);\n    }\n\n    return obj;\n  }, {});\n};\n\nexport const rehydrate = async (\n  store: Store,\n  rememberedKeys: string[],\n  {\n    prefix,\n    driver,\n    persistWholeStore,\n    unserialize,\n    errorHandler\n  }: RehydrateOptions\n) => {\n  let state = store.getState();\n\n  try {\n    const load = persistWholeStore\n      ? loadAll\n      : loadAllKeyed;\n\n    state = {\n      ...state,\n      ...await load({\n        rememberedKeys,\n        driver,\n        prefix,\n        unserialize\n      })\n    };\n  } catch (err) {\n    errorHandler(new RehydrateError(err));\n  }\n\n  store.dispatch({\n    type: REMEMBER_REHYDRATED,\n    payload: state\n  });\n};\n"],"mappings":"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","ignoreList":[]}