{"version":3,"file":"init.cjs","names":["_rehydrate","require","_persist","_actionTypes","_utils","_isDeepEqual","_interopRequireDefault","e","__esModule","asyncGeneratorStep","n","t","r","o","a","c","i","u","value","done","Promise","resolve","then","_asyncToGenerator","arguments","apply","_next","_throw","init","_ref2","store","rememberedKeys","_ref","prefix","driver","serialize","unserialize","persistThrottle","persistDebounce","persistWholeStore","errorHandler","rehydrate","oldState","persistFunc","_ref3","state","pick","getState","persist","isDeepEqual","dispatch","type","REMEMBER_PERSISTED","payload","subscribe","debounce","throttle","_x","_x2","_x3","_default","exports"],"sources":["../../src/init.ts"],"sourcesContent":["import { Store } from 'redux';\nimport { ExtendedOptions } from './types';\nimport { rehydrate } from './rehydrate';\nimport { persist } from './persist';\nimport { REMEMBER_PERSISTED } from './action-types';\nimport { pick, throttle, debounce } from './utils';\nimport isDeepEqual from './is-deep-equal';\n\nconst init = async (\n  store: Store<any, any>,\n  rememberedKeys: string[],\n  {\n    prefix,\n    driver,\n    serialize,\n    unserialize,\n    persistThrottle,\n    persistDebounce,\n    persistWholeStore,\n    errorHandler\n  }: ExtendedOptions\n) => {\n  await rehydrate(\n    store,\n    rememberedKeys,\n    { prefix, driver, unserialize, persistWholeStore, errorHandler }\n  );\n\n  let oldState = {};\n\n  const persistFunc = async () => {\n    const state = pick(\n      store.getState(),\n      rememberedKeys\n    );\n\n    await persist(\n      state,\n      oldState,\n      { prefix, driver, serialize, persistWholeStore, errorHandler }\n    );\n\n    if (!isDeepEqual(state, oldState)) {\n      store.dispatch({\n        type: REMEMBER_PERSISTED,\n        payload: state\n      });\n    }\n\n    oldState = state;\n  };\n\n  if (persistDebounce && persistDebounce > 0) {\n    store.subscribe(debounce(persistFunc, persistDebounce));\n  } else {\n    store.subscribe(throttle(persistFunc, persistThrottle));\n  }\n};\n\nexport default init;\n"],"mappings":"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","ignoreList":[]}