{"version":3,"file":"index.mjs","names":["init","REMEMBER_REHYDRATED","REMEMBER_PERSISTED","combineReducers","rememberReducer","reducer","data","state","action","_action$type","type","startsWith","_objectSpread","rootReducer","rehydratedState","payload","rememberEnhancer","driver","rememberedKeys","_temp","_ref","_ref$prefix","prefix","_ref$serialize","serialize","JSON","stringify","_ref$unserialize","unserialize","parse","_ref$persistThrottle","persistThrottle","persistDebounce","_ref$persistWholeStor","persistWholeStore","initActionType","_ref$errorHandler","errorHandler","console","warn","storeCreator","createStore","preloadedState","enhancer","isInitialized","initialize","store","setTimeout"],"sources":["../../src/index.ts"],"sourcesContent":["import init from './init';\nimport { REMEMBER_REHYDRATED, REMEMBER_PERSISTED } from './action-types';\nimport { Driver, Options } from './types';\nimport {\n  Action,\n  StoreEnhancer,\n  Reducer,\n  Store,\n  StoreCreator,\n  ReducersMapObject,\n  combineReducers,\n  UnknownAction\n} from 'redux';\n\nexport * from './errors';\nexport * from './types';\n\nconst rememberReducer = <S = any, A extends Action = UnknownAction, PreloadedState = S>(\n  reducer: Reducer<S, A, PreloadedState> | ReducersMapObject<S, A, PreloadedState>\n): Reducer<S, A, PreloadedState> => {\n  const data: any = {\n    state: {}\n  };\n\n  return (state: any = data.state, action: any) => {\n    if (action.type && (\n      action?.type === '@@INIT'\n      || action?.type?.startsWith('@@redux/INIT')\n    )) {\n      data.state = { ...state };\n    }\n\n    const rootReducer = typeof reducer === 'function'\n      ? reducer\n      : combineReducers(reducer);\n\n    switch (action.type) {\n      case REMEMBER_REHYDRATED: {\n        const rehydratedState = {\n          ...data.state,\n          ...(action?.payload || {})\n        };\n\n        data.state = rootReducer(\n          rehydratedState,\n          {\n            type: REMEMBER_REHYDRATED,\n            payload: rehydratedState\n          } as any\n        );\n\n        return data.state;\n      }\n      default:\n        return rootReducer(\n          state,\n          action\n        );\n    }\n  };\n};\n\nconst rememberEnhancer = <Ext extends {} = {}, StateExt extends {} = {}>(\n  driver: Driver,\n  rememberedKeys: string[],\n  {\n    prefix = '@@remember-',\n    serialize = (data) => JSON.stringify(data),\n    unserialize = (data) => JSON.parse(data),\n    persistThrottle = 100,\n    persistDebounce,\n    persistWholeStore = false,\n    initActionType,\n    errorHandler = console.warn\n  }: Partial<Options> = {}\n): StoreEnhancer<Ext, StateExt> => {\n  const storeCreator = (createStore: StoreCreator): StoreCreator => (\n    rootReducer: Reducer<any>,\n    preloadedState?: any,\n    enhancer?: StoreEnhancer\n  ): Store => {\n    let isInitialized = false;\n    const initialize = (store: Store) => init(\n      store,\n      rememberedKeys,\n      {\n        driver,\n        prefix,\n        serialize,\n        unserialize,\n        persistThrottle,\n        persistDebounce,\n        persistWholeStore,\n        errorHandler\n      }\n    );\n\n    const store = createStore(\n      (state, action) => {\n        if (!isInitialized\n          && initActionType\n          && action.type === initActionType\n        ) {\n          isInitialized = true;\n          setTimeout(() => initialize(store), 0);\n        }\n\n        return rootReducer(state, action);\n      },\n      preloadedState,\n      enhancer\n    );\n\n    if (!initActionType) {\n      isInitialized = true;\n      void initialize(store);\n    }\n\n    return store;\n  };\n\n  return storeCreator;\n};\n\nexport {\n  rememberReducer,\n  rememberEnhancer,\n  REMEMBER_REHYDRATED,\n  REMEMBER_PERSISTED\n};\n"],"mappings":";;;;;AAAA,OAAOA,IAAI;AACX,SAASC,mBAAmB,EAAEC,kBAAkB;AAEhD,SAOEC,eAAe,QAEV,OAAO;AAEd;AACA;AAEA,IAAMC,eAAe,GAAG,SAAlBA,eAAeA,CACnBC,OAAgF,EAC9C;EAClC,IAAMC,IAAS,GAAG;IAChBC,KAAK,EAAE,CAAC;EACV,CAAC;EAED,OAAO,UAACA,KAAU,EAAeC,MAAW,EAAK;IAAA,IAAAC,YAAA;IAAA,IAAzCF,KAAU;MAAVA,KAAU,GAAGD,IAAI,CAACC,KAAK;IAAA;IAC7B,IAAIC,MAAM,CAACE,IAAI,KACb,CAAAF,MAAM,oBAANA,MAAM,CAAEE,IAAI,MAAK,QAAQ,IACtBF,MAAM,aAAAC,YAAA,GAAND,MAAM,CAAEE,IAAI,aAAZD,YAAA,CAAcE,UAAU,CAAC,cAAc,CAAC,CAC5C,EAAE;MACDL,IAAI,CAACC,KAAK,GAAAK,aAAA,KAAQL,KAAK,CAAE;IAC3B;IAEA,IAAMM,WAAW,GAAG,OAAOR,OAAO,KAAK,UAAU,GAC7CA,OAAO,GACPF,eAAe,CAACE,OAAO,CAAC;IAE5B,QAAQG,MAAM,CAACE,IAAI;MACjB,KAAKT,mBAAmB;QAAE;UACxB,IAAMa,eAAe,GAAAF,aAAA,CAAAA,aAAA,KAChBN,IAAI,CAACC,KAAK,GACT,CAAAC,MAAM,oBAANA,MAAM,CAAEO,OAAO,KAAI,CAAC,CAAC,CAC1B;UAEDT,IAAI,CAACC,KAAK,GAAGM,WAAW,CACtBC,eAAe,EACf;YACEJ,IAAI,EAAET,mBAAmB;YACzBc,OAAO,EAAED;UACX,CACF,CAAC;UAED,OAAOR,IAAI,CAACC,KAAK;QACnB;MACA;QACE,OAAOM,WAAW,CAChBN,KAAK,EACLC,MACF,CAAC;IACL;EACF,CAAC;AACH,CAAC;AAED,IAAMQ,gBAAgB,GAAG,SAAnBA,gBAAgBA,CACpBC,MAAc,EACdC,cAAwB,EAAAC,KAAA,EAWS;EAAA,IAAAC,IAAA,GAAAD,KAAA,cADX,CAAC,CAAC,GAAAA,KAAA;IAAAE,WAAA,GAAAD,IAAA,CARtBE,MAAM;IAANA,MAAM,GAAAD,WAAA,cAAG,aAAa,GAAAA,WAAA;IAAAE,cAAA,GAAAH,IAAA,CACtBI,SAAS;IAATA,SAAS,GAAAD,cAAA,cAAG,UAACjB,IAAI;MAAA,OAAKmB,IAAI,CAACC,SAAS,CAACpB,IAAI,CAAC;IAAA,IAAAiB,cAAA;IAAAI,gBAAA,GAAAP,IAAA,CAC1CQ,WAAW;IAAXA,WAAW,GAAAD,gBAAA,cAAG,UAACrB,IAAI;MAAA,OAAKmB,IAAI,CAACI,KAAK,CAACvB,IAAI,CAAC;IAAA,IAAAqB,gBAAA;IAAAG,oBAAA,GAAAV,IAAA,CACxCW,eAAe;IAAfA,eAAe,GAAAD,oBAAA,cAAG,GAAG,GAAAA,oBAAA;IACrBE,eAAe,GAAAZ,IAAA,CAAfY,eAAe;IAAAC,qBAAA,GAAAb,IAAA,CACfc,iBAAiB;IAAjBA,iBAAiB,GAAAD,qBAAA,cAAG,KAAK,GAAAA,qBAAA;IACzBE,cAAc,GAAAf,IAAA,CAAde,cAAc;IAAAC,iBAAA,GAAAhB,IAAA,CACdiB,YAAY;IAAZA,YAAY,GAAAD,iBAAA,cAAGE,OAAO,CAACC,IAAI,GAAAH,iBAAA;EAG7B,IAAMI,YAAY,GAAG,SAAfA,YAAYA,CAAIC,WAAyB;IAAA,OAAmB,UAChE5B,WAAyB,EACzB6B,cAAoB,EACpBC,QAAwB,EACd;MACV,IAAIC,aAAa,GAAG,KAAK;MACzB,IAAMC,UAAU,GAAG,SAAbA,UAAUA,CAAIC,KAAY;QAAA,OAAK9C,IAAI,CACvC8C,KAAK,EACL5B,cAAc,EACd;UACED,MAAM,EAANA,MAAM;UACNK,MAAM,EAANA,MAAM;UACNE,SAAS,EAATA,SAAS;UACTI,WAAW,EAAXA,WAAW;UACXG,eAAe,EAAfA,eAAe;UACfC,eAAe,EAAfA,eAAe;UACfE,iBAAiB,EAAjBA,iBAAiB;UACjBG,YAAY,EAAZA;QACF,CACF,CAAC;MAAA;MAED,IAAMS,KAAK,GAAGL,WAAW,CACvB,UAAClC,KAAK,EAAEC,MAAM,EAAK;QACjB,IAAI,CAACoC,aAAa,IACbT,cAAc,IACd3B,MAAM,CAACE,IAAI,KAAKyB,cAAc,EACjC;UACAS,aAAa,GAAG,IAAI;UACpBG,UAAU,CAAC;YAAA,OAAMF,UAAU,CAACC,KAAK,CAAC;UAAA,GAAE,CAAC,CAAC;QACxC;QAEA,OAAOjC,WAAW,CAACN,KAAK,EAAEC,MAAM,CAAC;MACnC,CAAC,EACDkC,cAAc,EACdC,QACF,CAAC;MAED,IAAI,CAACR,cAAc,EAAE;QACnBS,aAAa,GAAG,IAAI;QACpB,KAAKC,UAAU,CAACC,KAAK,CAAC;MACxB;MAEA,OAAOA,KAAK;IACd,CAAC;EAAA;EAED,OAAON,YAAY;AACrB,CAAC;AAED,SACEpC,eAAe,EACfY,gBAAgB,EAChBf,mBAAmB,EACnBC,kBAAkB","ignoreList":[]}