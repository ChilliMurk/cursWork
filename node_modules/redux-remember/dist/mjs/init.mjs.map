{"version":3,"file":"init.mjs","names":["rehydrate","persist","REMEMBER_PERSISTED","pick","throttle","debounce","isDeepEqual","init","_ref2","_asyncToGenerator","store","rememberedKeys","_ref","prefix","driver","serialize","unserialize","persistThrottle","persistDebounce","persistWholeStore","errorHandler","oldState","persistFunc","_ref3","state","getState","dispatch","type","payload","apply","arguments","subscribe","_x","_x2","_x3"],"sources":["../../src/init.ts"],"sourcesContent":["import { Store } from 'redux';\nimport { ExtendedOptions } from './types';\nimport { rehydrate } from './rehydrate';\nimport { persist } from './persist';\nimport { REMEMBER_PERSISTED } from './action-types';\nimport { pick, throttle, debounce } from './utils';\nimport isDeepEqual from './is-deep-equal';\n\nconst init = async (\n  store: Store<any, any>,\n  rememberedKeys: string[],\n  {\n    prefix,\n    driver,\n    serialize,\n    unserialize,\n    persistThrottle,\n    persistDebounce,\n    persistWholeStore,\n    errorHandler\n  }: ExtendedOptions\n) => {\n  await rehydrate(\n    store,\n    rememberedKeys,\n    { prefix, driver, unserialize, persistWholeStore, errorHandler }\n  );\n\n  let oldState = {};\n\n  const persistFunc = async () => {\n    const state = pick(\n      store.getState(),\n      rememberedKeys\n    );\n\n    await persist(\n      state,\n      oldState,\n      { prefix, driver, serialize, persistWholeStore, errorHandler }\n    );\n\n    if (!isDeepEqual(state, oldState)) {\n      store.dispatch({\n        type: REMEMBER_PERSISTED,\n        payload: state\n      });\n    }\n\n    oldState = state;\n  };\n\n  if (persistDebounce && persistDebounce > 0) {\n    store.subscribe(debounce(persistFunc, persistDebounce));\n  } else {\n    store.subscribe(throttle(persistFunc, persistThrottle));\n  }\n};\n\nexport default init;\n"],"mappings":";;AAEA,SAASA,SAAS;AAClB,SAASC,OAAO;AAChB,SAASC,kBAAkB;AAC3B,SAASC,IAAI,EAAEC,QAAQ,EAAEC,QAAQ;AACjC,OAAOC,WAAW;AAElB,IAAMC,IAAI;EAAA,IAAAC,KAAA,GAAAC,iBAAA,CAAG,WACXC,KAAsB,EACtBC,cAAwB,EAAAC,IAAA,EAWrB;IAAA,IATDC,MAAM,GAAAD,IAAA,CAANC,MAAM;MACNC,MAAM,GAAAF,IAAA,CAANE,MAAM;MACNC,SAAS,GAAAH,IAAA,CAATG,SAAS;MACTC,WAAW,GAAAJ,IAAA,CAAXI,WAAW;MACXC,eAAe,GAAAL,IAAA,CAAfK,eAAe;MACfC,eAAe,GAAAN,IAAA,CAAfM,eAAe;MACfC,iBAAiB,GAAAP,IAAA,CAAjBO,iBAAiB;MACjBC,YAAY,GAAAR,IAAA,CAAZQ,YAAY;IAGd,MAAMpB,SAAS,CACbU,KAAK,EACLC,cAAc,EACd;MAAEE,MAAM,EAANA,MAAM;MAAEC,MAAM,EAANA,MAAM;MAAEE,WAAW,EAAXA,WAAW;MAAEG,iBAAiB,EAAjBA,iBAAiB;MAAEC,YAAY,EAAZA;IAAa,CACjE,CAAC;IAED,IAAIC,QAAQ,GAAG,CAAC,CAAC;IAEjB,IAAMC,WAAW;MAAA,IAAAC,KAAA,GAAAd,iBAAA,CAAG,aAAY;QAC9B,IAAMe,KAAK,GAAGrB,IAAI,CAChBO,KAAK,CAACe,QAAQ,CAAC,CAAC,EAChBd,cACF,CAAC;QAED,MAAMV,OAAO,CACXuB,KAAK,EACLH,QAAQ,EACR;UAAER,MAAM,EAANA,MAAM;UAAEC,MAAM,EAANA,MAAM;UAAEC,SAAS,EAATA,SAAS;UAAEI,iBAAiB,EAAjBA,iBAAiB;UAAEC,YAAY,EAAZA;QAAa,CAC/D,CAAC;QAED,IAAI,CAACd,WAAW,CAACkB,KAAK,EAAEH,QAAQ,CAAC,EAAE;UACjCX,KAAK,CAACgB,QAAQ,CAAC;YACbC,IAAI,EAAEzB,kBAAkB;YACxB0B,OAAO,EAAEJ;UACX,CAAC,CAAC;QACJ;QAEAH,QAAQ,GAAGG,KAAK;MAClB,CAAC;MAAA,gBApBKF,WAAWA,CAAA;QAAA,OAAAC,KAAA,CAAAM,KAAA,OAAAC,SAAA;MAAA;IAAA,GAoBhB;IAED,IAAIZ,eAAe,IAAIA,eAAe,GAAG,CAAC,EAAE;MAC1CR,KAAK,CAACqB,SAAS,CAAC1B,QAAQ,CAACiB,WAAW,EAAEJ,eAAe,CAAC,CAAC;IACzD,CAAC,MAAM;MACLR,KAAK,CAACqB,SAAS,CAAC3B,QAAQ,CAACkB,WAAW,EAAEL,eAAe,CAAC,CAAC;IACzD;EACF,CAAC;EAAA,gBAjDKV,IAAIA,CAAAyB,EAAA,EAAAC,GAAA,EAAAC,GAAA;IAAA,OAAA1B,KAAA,CAAAqB,KAAA,OAAAC,SAAA;EAAA;AAAA,GAiDT;AAED,eAAevB,IAAI","ignoreList":[]}