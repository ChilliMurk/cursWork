{"version":3,"file":"persist.mjs","names":["PersistError","isDeepEqual","saveAll","state","oldState","_ref","prefix","driver","serialize","setItem","saveAllKeyed","_ref2","Promise","all","Object","keys","map","key","resolve","persist","_ref4","_asyncToGenerator","_ref3","persistWholeStore","errorHandler","save","err","_x","_x2","_x3","apply","arguments"],"sources":["../../src/persist.ts"],"sourcesContent":["import { PersistError } from './errors';\nimport isDeepEqual from './is-deep-equal';\nimport { ExtendedOptions } from './types';\n\ntype PersistOptions = Pick<\n  ExtendedOptions,\n  'prefix' | 'driver' | 'serialize' | 'persistWholeStore' | 'errorHandler'\n>\n\ntype SaveAllOptions = Pick<\n  ExtendedOptions,\n  'prefix' | 'driver' | 'serialize'\n>;\n\nexport const saveAll = (\n  state: any,\n  oldState: any,\n  { prefix, driver, serialize }: SaveAllOptions\n) => {\n  if (!isDeepEqual(state, oldState)) {\n    return driver.setItem(\n      `${prefix}rootState`,\n      serialize(state, 'rootState')\n    );\n  }\n};\n\nexport const saveAllKeyed = (\n  state: any,\n  oldState: any,\n  { prefix, driver, serialize }: SaveAllOptions\n) => Promise.all(\n  Object.keys(state).map((key) => {\n    if (isDeepEqual(state[key], oldState[key])) {\n      return Promise.resolve();\n    }\n\n    return driver.setItem(\n      `${prefix}${key}`,\n      serialize(state[key], key)\n    );\n  })\n);\n\nexport const persist = async (\n  state = {},\n  oldState = {},\n  {\n    prefix,\n    driver,\n    persistWholeStore,\n    serialize,\n    errorHandler\n  }: PersistOptions\n) => {\n  try {\n    const save = persistWholeStore\n      ? saveAll\n      : saveAllKeyed;\n\n    await save(\n      state,\n      oldState,\n      { prefix, driver, serialize }\n    );\n  } catch (err) {\n    errorHandler(new PersistError(err));\n  }\n};\n"],"mappings":";;AAAA,SAASA,YAAY;AACrB,OAAOC,WAAW;AAalB,OAAO,IAAMC,OAAO,GAAG,SAAVA,OAAOA,CAClBC,KAAU,EACVC,QAAa,EAAAC,IAAA,EAEV;EAAA,IADDC,MAAM,GAAAD,IAAA,CAANC,MAAM;IAAEC,MAAM,GAAAF,IAAA,CAANE,MAAM;IAAEC,SAAS,GAAAH,IAAA,CAATG,SAAS;EAE3B,IAAI,CAACP,WAAW,CAACE,KAAK,EAAEC,QAAQ,CAAC,EAAE;IACjC,OAAOG,MAAM,CAACE,OAAO,CAChBH,MAAM,gBACTE,SAAS,CAACL,KAAK,EAAE,WAAW,CAC9B,CAAC;EACH;AACF,CAAC;AAED,OAAO,IAAMO,YAAY,GAAG,SAAfA,YAAYA,CACvBP,KAAU,EACVC,QAAa,EAAAO,KAAA;EAAA,IACXL,MAAM,GAAAK,KAAA,CAANL,MAAM;IAAEC,MAAM,GAAAI,KAAA,CAANJ,MAAM;IAAEC,SAAS,GAAAG,KAAA,CAATH,SAAS;EAAA,OACxBI,OAAO,CAACC,GAAG,CACdC,MAAM,CAACC,IAAI,CAACZ,KAAK,CAAC,CAACa,GAAG,CAAC,UAACC,GAAG,EAAK;IAC9B,IAAIhB,WAAW,CAACE,KAAK,CAACc,GAAG,CAAC,EAAEb,QAAQ,CAACa,GAAG,CAAC,CAAC,EAAE;MAC1C,OAAOL,OAAO,CAACM,OAAO,CAAC,CAAC;IAC1B;IAEA,OAAOX,MAAM,CAACE,OAAO,MAChBH,MAAM,GAAGW,GAAG,EACfT,SAAS,CAACL,KAAK,CAACc,GAAG,CAAC,EAAEA,GAAG,CAC3B,CAAC;EACH,CAAC,CACH,CAAC;AAAA;AAED,OAAO,IAAME,OAAO;EAAA,IAAAC,KAAA,GAAAC,iBAAA,CAAG,WACrBlB,KAAK,EACLC,QAAQ,EAAAkB,KAAA,EAQL;IAAA,IATHnB,KAAK;MAALA,KAAK,GAAG,CAAC,CAAC;IAAA;IAAA,IACVC,QAAQ;MAARA,QAAQ,GAAG,CAAC,CAAC;IAAA;IAAA,IAEXE,MAAM,GAAAgB,KAAA,CAANhB,MAAM;MACNC,MAAM,GAAAe,KAAA,CAANf,MAAM;MACNgB,iBAAiB,GAAAD,KAAA,CAAjBC,iBAAiB;MACjBf,SAAS,GAAAc,KAAA,CAATd,SAAS;MACTgB,YAAY,GAAAF,KAAA,CAAZE,YAAY;IAGd,IAAI;MACF,IAAMC,IAAI,GAAGF,iBAAiB,GAC1BrB,OAAO,GACPQ,YAAY;MAEhB,MAAMe,IAAI,CACRtB,KAAK,EACLC,QAAQ,EACR;QAAEE,MAAM,EAANA,MAAM;QAAEC,MAAM,EAANA,MAAM;QAAEC,SAAS,EAATA;MAAU,CAC9B,CAAC;IACH,CAAC,CAAC,OAAOkB,GAAG,EAAE;MACZF,YAAY,CAAC,IAAIxB,YAAY,CAAC0B,GAAG,CAAC,CAAC;IACrC;EACF,CAAC;EAAA,gBAxBYP,OAAOA,CAAAQ,EAAA,EAAAC,GAAA,EAAAC,GAAA;IAAA,OAAAT,KAAA,CAAAU,KAAA,OAAAC,SAAA;EAAA;AAAA,GAwBnB","ignoreList":[]}