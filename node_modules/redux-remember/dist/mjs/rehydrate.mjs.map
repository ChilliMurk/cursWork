{"version":3,"file":"rehydrate.mjs","names":["REMEMBER_REHYDRATED","pick","RehydrateError","loadAll","_ref2","_asyncToGenerator","_ref","rememberedKeys","driver","prefix","unserialize","key","data","getItem","undefined","_x","apply","arguments","loadAllKeyed","_ref4","_ref3","items","Promise","all","map","reduce","obj","i","_x2","rehydrate","_ref6","store","_ref5","persistWholeStore","errorHandler","state","getState","load","_objectSpread","err","dispatch","type","payload","_x3","_x4","_x5"],"sources":["../../src/rehydrate.ts"],"sourcesContent":["import { Store } from 'redux';\nimport { REMEMBER_REHYDRATED } from './action-types';\nimport { ExtendedOptions } from './types';\nimport { pick } from './utils';\nimport { RehydrateError } from './errors';\n\ntype RehydrateOptions = Pick<\n  ExtendedOptions,\n  'driver' | 'prefix' | 'unserialize' | 'persistWholeStore' | 'errorHandler'\n>\n\ntype LoadAllOptions = Pick<\n  ExtendedOptions,\n  'driver' | 'prefix' | 'unserialize'\n> & {\n  rememberedKeys: string[]\n};\n\nexport const loadAll = async ({\n  rememberedKeys,\n  driver,\n  prefix,\n  unserialize\n}: LoadAllOptions): Promise<Record<string, any>> => {\n  const key = 'rootState';\n  const data = await driver.getItem(`${prefix}${key}`);\n\n  if (data === null || data === undefined) {\n    return {};\n  }\n\n  return pick(\n    unserialize(data, key),\n    rememberedKeys\n  );\n};\n\nexport const loadAllKeyed = async ({\n  rememberedKeys,\n  driver,\n  prefix,\n  unserialize\n}: LoadAllOptions): Promise<Record<string, any>> => {\n  const items = await Promise.all(\n    rememberedKeys.map((key) => driver.getItem(\n      `${prefix}${key}`\n    ))\n  );\n\n  return rememberedKeys.reduce((obj: Record<string, any>, key, i) => {\n    if (items[i] !== null && items[i] !== undefined) {\n      obj[key] = unserialize(items[i], key);\n    }\n\n    return obj;\n  }, {});\n};\n\nexport const rehydrate = async (\n  store: Store,\n  rememberedKeys: string[],\n  {\n    prefix,\n    driver,\n    persistWholeStore,\n    unserialize,\n    errorHandler\n  }: RehydrateOptions\n) => {\n  let state = store.getState();\n\n  try {\n    const load = persistWholeStore\n      ? loadAll\n      : loadAllKeyed;\n\n    state = {\n      ...state,\n      ...await load({\n        rememberedKeys,\n        driver,\n        prefix,\n        unserialize\n      })\n    };\n  } catch (err) {\n    errorHandler(new RehydrateError(err));\n  }\n\n  store.dispatch({\n    type: REMEMBER_REHYDRATED,\n    payload: state\n  });\n};\n"],"mappings":"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","ignoreList":[]}